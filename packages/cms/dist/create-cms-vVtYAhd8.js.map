{"version":3,"file":"create-cms-vVtYAhd8.js","names":["file: string | null","defaultOptions: Required<CreateCMSOptions>","body: unknown"],"sources":["../src/templates/root.ts","../src/admin-panel.ts","../src/get-router.ts","../src/create-cms.ts"],"sourcesContent":["export const htmlTemplate = ({\n  title,\n  body,\n}: {\n  title: string;\n  body: string;\n}): string => `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>${title}</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <link rel=\"stylesheet\" href=\"/admin/static/bundle.css\" />\n  <style>\n    /* Ensure CMS root takes full viewport */\n    body, html {\n      margin: 0;\n      padding: 0;\n      height: 100%;\n    }\n    #cms-root {\n      min-height: 100vh;\n    }\n  </style>\n</head>\n<body>\n  ${body}\n</body>\n</html>`;\n","import { htmlTemplate } from \"./templates/root\";\n\nexport const renderAdminPanel = (): string => {\n  return htmlTemplate({\n    title: \"CMS Admin Panel\",\n    body: `\n      <div id=\"cms-root\"></div>\n      <script src=\"/admin/static/bundle.js\" type=\"module\"></script>\n    `,\n  });\n};\n","import type { CreateCMSOptions } from \"./index\";\nimport { renderAdminPanel } from \"./admin-panel\";\nimport { readFile } from \"fs/promises\";\nimport { join } from \"path\";\n\n/**\n * Internal router for handling GET requests to the CMS\n */\nexport const runGetRouter = async (\n  req: Request,\n  opts: Required<CreateCMSOptions>\n): Promise<Response> => {\n  const url = new URL(req.url);\n  const { pathname } = url;\n  const adminRoute = pathname.split(opts.basePath)[1] || \"\";\n\n  // Handle static assets\n  if (adminRoute.startsWith(\"/static/\")) {\n    const staticPath = adminRoute.replace(\"/static/\", \"\");\n\n    // Determine content type\n    let contentType = \"text/plain\";\n    if (staticPath.endsWith(\".js\")) {\n      contentType = \"application/javascript\";\n    } else if (staticPath.endsWith(\".css\")) {\n      contentType = \"text/css\";\n    } else if (staticPath.endsWith(\".json\")) {\n      contentType = \"application/json\";\n    }\n\n    try {\n      // Try multiple paths to find the static files\n      const possiblePaths = [\n        // When used as a package in node_modules\n        join(process.cwd(), \"node_modules\", \"@turbulence\", \"cms\", \"static\", staticPath),\n        // When running in monorepo development\n        join(process.cwd(), \"..\", \"..\", \"packages\", \"cms\", \"static\", staticPath),\n        // Direct path (for development)\n        join(process.cwd(), \"packages\", \"cms\", \"static\", staticPath),\n      ];\n\n      let file: string | null = null;\n      for (const filePath of possiblePaths) {\n        try {\n          file = await readFile(filePath, \"utf-8\");\n          break;\n        } catch {\n          // Try next path\n        }\n      }\n\n      if (!file) {\n        throw new Error(\"File not found\");\n      }\n\n      return new Response(file, {\n        headers: {\n          \"Content-Type\": contentType,\n          \"Cache-Control\": \"no-store\",\n        },\n      });\n    } catch {\n      return new Response(\"Not Found\", {\n        status: 404,\n        headers: {\n          \"Content-Type\": \"text/plain\",\n          \"Cache-Control\": \"no-store\",\n        },\n      });\n    }\n  }\n\n  // Default: render the admin panel\n  return new Response(renderAdminPanel(), {\n    headers: {\n      \"Content-Type\": \"text/html\",\n      \"Cache-Control\": \"no-store\",\n    },\n  });\n};\n","import type { CreateCMSOptions, CMSHandlers } from \"./index\";\nimport { runGetRouter } from \"./get-router\";\n\nconst defaultOptions: Required<CreateCMSOptions> = {\n  basePath: \"/admin\",\n};\n\n/**\n * Creates a CMS instance with GET and POST handlers\n * Uses Web Standard Request/Response - works with any framework\n */\nexport const createCMS = (options?: CreateCMSOptions): CMSHandlers => {\n  const opts = { ...defaultOptions, ...options };\n\n  const GET = async (req: Request): Promise<Response> => {\n    const url = new URL(req.url);\n    const { pathname } = url;\n\n    const isAdmin = pathname.startsWith(opts.basePath);\n    if (!isAdmin) {\n      return Response.json({\n        message:\n          \"Please put your CMS in the /admin route. Or customize basePath in the options.\",\n      });\n    }\n\n    return await runGetRouter(req, opts);\n  };\n\n  const POST = async (req: Request): Promise<Response> => {\n    const url = new URL(req.url);\n    const { pathname } = url;\n    const isAdmin = pathname.startsWith(opts.basePath);\n\n    if (!isAdmin) {\n      return Response.json({\n        message:\n          \"Please put your CMS in the /admin route. Or customize basePath in the options.\",\n      });\n    }\n\n    let body: unknown = null;\n    try {\n      body = await req.json();\n    } catch {\n      // Body might not be JSON\n    }\n\n    return Response.json({\n      message: \"Hello from CMS\",\n      method: req.method,\n      pathname,\n      query: url.searchParams.toString(),\n      body,\n      headers: Object.fromEntries(req.headers.entries()),\n    });\n  };\n\n  return { GET, POST };\n};\n"],"mappings":";;;;AAAA,MAAa,gBAAgB,EAC3B,OACA,WAIY;;;;WAIH,MAAM;;;;;;;;;;;;;;;;IAgBb,KAAK;;;;;;ACxBT,MAAa,yBAAiC;AAC5C,QAAO,aAAa;EAClB,OAAO;EACP,MAAM;;;;EAIP,CAAC;;;;;;;;ACDJ,MAAa,eAAe,OAC1B,KACA,SACsB;CAEtB,MAAM,EAAE,aADI,IAAI,IAAI,IAAI,IAAI;CAE5B,MAAM,aAAa,SAAS,MAAM,KAAK,SAAS,CAAC,MAAM;AAGvD,KAAI,WAAW,WAAW,WAAW,EAAE;EACrC,MAAM,aAAa,WAAW,QAAQ,YAAY,GAAG;EAGrD,IAAI,cAAc;AAClB,MAAI,WAAW,SAAS,MAAM,CAC5B,eAAc;WACL,WAAW,SAAS,OAAO,CACpC,eAAc;WACL,WAAW,SAAS,QAAQ,CACrC,eAAc;AAGhB,MAAI;GAEF,MAAM,gBAAgB;IAEpB,KAAK,QAAQ,KAAK,EAAE,gBAAgB,eAAe,OAAO,UAAU,WAAW;IAE/E,KAAK,QAAQ,KAAK,EAAE,MAAM,MAAM,YAAY,OAAO,UAAU,WAAW;IAExE,KAAK,QAAQ,KAAK,EAAE,YAAY,OAAO,UAAU,WAAW;IAC7D;GAED,IAAIA,OAAsB;AAC1B,QAAK,MAAM,YAAY,cACrB,KAAI;AACF,WAAO,MAAM,SAAS,UAAU,QAAQ;AACxC;WACM;AAKV,OAAI,CAAC,KACH,OAAM,IAAI,MAAM,iBAAiB;AAGnC,UAAO,IAAI,SAAS,MAAM,EACxB,SAAS;IACP,gBAAgB;IAChB,iBAAiB;IAClB,EACF,CAAC;UACI;AACN,UAAO,IAAI,SAAS,aAAa;IAC/B,QAAQ;IACR,SAAS;KACP,gBAAgB;KAChB,iBAAiB;KAClB;IACF,CAAC;;;AAKN,QAAO,IAAI,SAAS,kBAAkB,EAAE,EACtC,SAAS;EACP,gBAAgB;EAChB,iBAAiB;EAClB,EACF,CAAC;;;;;AC3EJ,MAAMC,iBAA6C,EACjD,UAAU,UACX;;;;;AAMD,MAAa,aAAa,YAA4C;CACpE,MAAM,OAAO;EAAE,GAAG;EAAgB,GAAG;EAAS;CAE9C,MAAM,MAAM,OAAO,QAAoC;EAErD,MAAM,EAAE,aADI,IAAI,IAAI,IAAI,IAAI;AAI5B,MAAI,CADY,SAAS,WAAW,KAAK,SAAS,CAEhD,QAAO,SAAS,KAAK,EACnB,SACE,kFACH,CAAC;AAGJ,SAAO,MAAM,aAAa,KAAK,KAAK;;CAGtC,MAAM,OAAO,OAAO,QAAoC;EACtD,MAAM,MAAM,IAAI,IAAI,IAAI,IAAI;EAC5B,MAAM,EAAE,aAAa;AAGrB,MAAI,CAFY,SAAS,WAAW,KAAK,SAAS,CAGhD,QAAO,SAAS,KAAK,EACnB,SACE,kFACH,CAAC;EAGJ,IAAIC,OAAgB;AACpB,MAAI;AACF,UAAO,MAAM,IAAI,MAAM;UACjB;AAIR,SAAO,SAAS,KAAK;GACnB,SAAS;GACT,QAAQ,IAAI;GACZ;GACA,OAAO,IAAI,aAAa,UAAU;GAClC;GACA,SAAS,OAAO,YAAY,IAAI,QAAQ,SAAS,CAAC;GACnD,CAAC;;AAGJ,QAAO;EAAE;EAAK;EAAM"}